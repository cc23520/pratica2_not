CREATE TRIGGER trg_UpdateTotalAmount
ON vendas.OrderItem
AFTER INSERT
AS
BEGIN
    DECLARE @idCompra INT;

    SELECT @idCompra = idCompra FROM inserted;

    UPDATE vendas.Compra
    SET TotalAmount = (
            SELECT SUM(subtotal)
            FROM vendas.OrderItem
            WHERE idCompra = @idCompra
        )
    WHERE idCompra = @idCompra;
END;
